<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TTS Tester</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef1f4;
      margin: 0;
      padding: 40px;
    }

    .container {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 480px;
      margin: auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
      color: #222;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #555;
      margin-bottom: 5px;
    }

    textarea {
      width: 100%;
      height: 120px;
      font-size: 15px;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
      box-sizing: border-box;
    }

    select {
      width: 100%;
      padding: 12px;
      font-size: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      background: white;
    }

    .row {
      display: flex;
      gap: 12px;
    }

    .row > div {
      flex: 1;
    }

    #voicePreview {
      font-size: 12px;
      color: #888;
      margin-top: -10px;
      margin-bottom: 14px;
      padding-left: 4px;
      min-height: 16px;
    }

    button#generateBtn {
      width: 100%;
      padding: 14px;
      background: #007bff;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s ease;
    }

    button#generateBtn:hover:not(:disabled) { background: #005fcc; }
    button#generateBtn:disabled {
      background: #90bfff;
      cursor: not-allowed;
    }

    audio {
      margin-top: 20px;
      width: 100%;
      display: none;
    }

    #status {
      margin-top: 14px;
      font-size: 14px;
      text-align: center;
      min-height: 20px;
    }

    #status.error   { color: #c0392b; }
    #status.info    { color: #2980b9; }
    #status.success { color: #27ae60; }
  </style>
</head>
<body>

<div class="container">
  <h2>Fallback TTS Tester</h2>

  <label for="textInput">Text</label>
  <textarea id="textInput" placeholder="Type your text here..."></textarea>

  <div class="row">
    <div>
      <label for="languageSelect">Language</label>
      <select id="languageSelect">
        <option value="hi-IN">Hindi</option>
        <option value="en-IN">English (India)</option>
        <option value="bn-IN">Bengali</option>
        <option value="mr-IN">Marathi</option>
        <option value="gu-IN">Gujarati</option>
        <option value="ta-IN">Tamil</option>
        <option value="te-IN">Telugu</option>
        <option value="kn-IN">Kannada</option>
        <option value="ml-IN">Malayalam</option>
        <option value="pa-IN">Punjabi</option>
        <option value="or-IN">Odia</option>
        <option value="as-IN">Assamese</option>
        <option value="kok-IN">Konkani</option>
        <option value="mai-IN">Maithili</option>
        <option value="ur-IN">Urdu</option>
      </select>
    </div>
    <div>
      <label for="voiceSelect">Voice</label>
      <select id="voiceSelect" onchange="updateVoicePreview()">
        <optgroup label="‚ú® Bright &amp; Upbeat">
          <option value="Zephyr"      >Zephyr</option>
          <option value="Leda"        >Leda</option>
          <option value="Autonoe"     >Autonoe</option>
          <option value="Callirrhoe"  >Callirrhoe</option>
          <option value="Sulafat"     >Sulafat</option>
        </optgroup>
        <optgroup label="üßò Calm &amp; Neutral">
          <option value="Aoede"       >Aoede</option>
          <option value="Kore"        >Kore</option>
          <option value="Schedar"     >Schedar</option>
          <option value="Vindemiatrix">Vindemiatrix</option>
          <option value="Pulcherrima" >Pulcherrima</option>
          <option value="Sadachbia"   >Sadachbia</option>
        </optgroup>
        <optgroup label="üéôÔ∏è Warm &amp; Deep">
          <option value="Puck"        >Puck</option>
          <option value="Charon"      >Charon</option>
          <option value="Fenrir"      >Fenrir</option>
          <option value="Orus"        >Orus</option>
          <option value="Achird"      >Achird</option>
          <option value="Sadaltager"  >Sadaltager</option>
          <option value="Zubenelgenubi">Zubenelgenubi</option>
        </optgroup>
        <optgroup label="üé≠ Expressive">
          <option value="Gacrux"      >Gacrux</option>
          <option value="Erinome"     >Erinome</option>
          <option value="Despina"     >Despina</option>
          <option value="Laomedeia"   >Laomedeia</option>
          <option value="Achernar"    >Achernar</option>
          <option value="Rasalgethi"  >Rasalgethi</option>
          <option value="Algieba"     >Algieba</option>
          <option value="Iocaste"     >Iocaste</option>
          <option value="Umbriel"     >Umbriel</option>
          <option value="Alnilam"     >Alnilam</option>
          <option value="Muntalir"    >Muntalir</option>
          <option value="Rukbat"      >Rukbat</option>
        </optgroup>
      </select>
    </div>
  </div>

  <div id="voicePreview">Breezy ¬∑ Female ‚Äî good default for Indic languages</div>

  <button id="generateBtn" onclick="generateTTS()">Generate Audio</button>

  <div id="status"></div>
  <audio id="audioPlayer" controls></audio>
</div>

<script>
  const voiceDescriptions = {
    Zephyr:          "Bright, energetic female voice",
    Leda:            "Youthful, fresh female voice",
    Autonoe:         "Bright female voice",
    Callirrhoe:      "Easy-going, relaxed female voice",
    Sulafat:         "Warm, friendly female voice",
    Aoede:           "Breezy, natural female voice ‚Äî good default for Indic languages",
    Kore:            "Firm, clear female voice ‚Äî good for formal content",
    Schedar:         "Even, steady female voice",
    Vindemiatrix:    "Gentle female voice",
    Pulcherrima:     "Forward, confident female voice",
    Sadachbia:       "Lively female voice",
    Puck:            "Upbeat male voice ‚Äî tested well for Hindi",
    Charon:          "Informative, measured male voice ‚Äî great for narration",
    Fenrir:          "Excitable, energetic male voice",
    Orus:            "Firm, authoritative male voice",
    Achird:          "Friendly, approachable male voice",
    Sadaltager:      "Knowledgeable, clear male voice",
    Zubenelgenubi:   "Casual, conversational male voice",
    Gacrux:          "Mature female voice",
    Erinome:         "Clear, precise female voice",
    Despina:         "Smooth female voice",
    Laomedeia:       "Upbeat female voice",
    Achernar:        "Soft, gentle female voice",
    Rasalgethi:      "Informative male voice",
    Algieba:         "Smooth, warm male voice",
    Iocaste:         "Warm female voice",
    Umbriel:         "Easy-going male voice",
    Alnilam:         "Firm male voice",
    Muntalir:        "Even, steady male voice",
    Rukbat:          "Warm male voice",
  };

  function updateVoicePreview() {
    const voice = document.getElementById("voiceSelect").value;
    document.getElementById("voicePreview").textContent =
      voiceDescriptions[voice] || "";
  }

  function setStatus(msg, type = "info") {
    const el = document.getElementById("status");
    el.textContent = msg;
    el.className = type;
  }

  async function generateTTS() {
    const text     = document.getElementById("textInput").value.trim();
    const language = document.getElementById("languageSelect").value;
    const voice    = document.getElementById("voiceSelect").value;
    const btn      = document.getElementById("generateBtn");
    const player   = document.getElementById("audioPlayer");

    if (!text) { setStatus("Please enter some text.", "error"); return; }

    btn.disabled = true;
    btn.textContent = "Generating‚Ä¶";
    setStatus("Sending request to TTS service‚Ä¶", "info");
    player.style.display = "none";

    try {
      const response = await fetch("http://localhost:5000/tts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text, language, voice, format: "wav", speed: 1 })
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || data.message || `HTTP ${response.status}`);
      }

      const audioBase64 = data.audioBase64 || data.audio;
      if (!audioBase64) throw new Error("No audio in response. Check server logs.");

      const mimeType = data.mimeType || "audio/wav";
      player.src = `data:${mimeType};base64,${audioBase64}`;
      player.style.display = "block";
      player.play();

      setStatus(`‚úÖ Playing ‚Äî Voice: ${voice} ¬∑ Provider: ${data.provider || "gemini"}`, "success");

    } catch (err) {
      setStatus("‚ùå Error: " + err.message, "error");
      console.error(err);
    } finally {
      btn.disabled = false;
      btn.textContent = "Generate Audio";
    }
  }

  updateVoicePreview();
</script>

</body>
</html>